"use strict";(globalThis.webpackChunknebula=globalThis.webpackChunknebula||[]).push([[185],{2990(e,n,i){i.r(n),i.d(n,{assets:()=>t,contentTitle:()=>s,default:()=>h,frontMatter:()=>d,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"clean-mail-automation","title":"Clean Mail Automation","description":"Dockerized IMAP mailbox cleanup with configurable retention, weekly scheduling, and optional Telegram notifications.","source":"@site/Projects/clean-mail-automation.md","sourceDirName":".","slug":"/clean-mail-automation","permalink":"/Nebula.KB-dev/Projects/clean-mail-automation","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"Projects","permalink":"/Nebula.KB-dev/Projects/tags/projects"},{"inline":true,"label":"Python","permalink":"/Nebula.KB-dev/Projects/tags/python"},{"inline":true,"label":"IMAP","permalink":"/Nebula.KB-dev/Projects/tags/imap"},{"inline":true,"label":"Docker","permalink":"/Nebula.KB-dev/Projects/tags/docker"}],"version":"current","sidebarPosition":2,"frontMatter":{"id":"clean-mail-automation","title":"Clean Mail Automation","description":"Dockerized IMAP mailbox cleanup with configurable retention, weekly scheduling, and optional Telegram notifications.","sidebar_position":2,"tags":["Projects","Python","IMAP","Docker"]},"sidebar":"projectsSidebar","previous":{"title":"Projects: introduction","permalink":"/Nebula.KB-dev/Projects/intro"},"next":{"title":"IntuneWinAppUtil GUI","permalink":"/Nebula.KB-dev/Projects/M365/intunewinapputilgui"}}');var l=i(4848),c=i(8453);const d={id:"clean-mail-automation",title:"Clean Mail Automation",description:"Dockerized IMAP mailbox cleanup with configurable retention, weekly scheduling, and optional Telegram notifications.",sidebar_position:2,tags:["Projects","Python","IMAP","Docker"]},s="Clean Mail Automation",t={},o=[{value:"Demo and repository",id:"demo-and-repository",level:2},{value:"Key features",id:"key-features",level:2},{value:"Architecture at a glance",id:"architecture-at-a-glance",level:2},{value:"Environment variables",id:"environment-variables",level:2},{value:"Quick start",id:"quick-start",level:2},{value:"Docker (GHCR, recommended)",id:"docker-ghcr-recommended",level:3},{value:"Docker (Docker Hub)",id:"docker-docker-hub",level:3},{value:"Docker build locally (optional)",id:"docker-build-locally-optional",level:3},{value:"Docker Compose",id:"docker-compose",level:3},{value:"Local run (no Docker)",id:"local-run-no-docker",level:3},{value:"Repository structure",id:"repository-structure",level:2},{value:"Operational notes",id:"operational-notes",level:2},{value:"License",id:"license",level:2}];function a(e){const n={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"clean-mail-automation",children:"Clean Mail Automation"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"clean-mail-automation"})," is a Docker-first utility that connects to an IMAP mailbox and deletes emails older than a configurable retention period (default: 10 days).",(0,l.jsx)(n.br,{}),"\n","It executes immediately at container startup and then runs on a weekly cron schedule."]}),"\n",(0,l.jsx)(n.h2,{id:"demo-and-repository",children:"Demo and repository"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Source code: ",(0,l.jsx)(n.a,{href:"https://github.com/gioxx/clean-mail-automation",children:"github.com/gioxx/clean-mail-automation"})]}),"\n",(0,l.jsxs)(n.li,{children:["Docker Hub image: ",(0,l.jsx)(n.code,{children:"gfsolone/clean-mail-automation"})]}),"\n",(0,l.jsxs)(n.li,{children:["GHCR image: ",(0,l.jsx)(n.code,{children:"ghcr.io/gioxx/clean-mail-automation"})]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"key-features",children:"Key features"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"IMAP over SSL connection with environment-based configuration."}),"\n",(0,l.jsxs)(n.li,{children:["Retention policy by days (",(0,l.jsx)(n.code,{children:"CLEAN_DAYS"}),") with per-run CLI override (",(0,l.jsx)(n.code,{children:"--days"}),")."]}),"\n",(0,l.jsx)(n.li,{children:"Optional Telegram summary notifications (success/failure, deleted count, duration)."}),"\n",(0,l.jsxs)(n.li,{children:["Weekly scheduling through container cron (",(0,l.jsx)(n.code,{children:"SCHEDULE_DAY"}),", ",(0,l.jsx)(n.code,{children:"SCHEDULE_HOUR"}),", ",(0,l.jsx)(n.code,{children:"SCHEDULE_MIN"}),")."]}),"\n",(0,l.jsx)(n.li,{children:"Logs routed to container stdout/stderr."}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"architecture-at-a-glance",children:"Architecture at a glance"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Script"})," (",(0,l.jsx)(n.code,{children:"clean_email.py"}),"): handles IMAP connection, filtering by age, deletion, and optional Telegram notification."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Entrypoint"})," (",(0,l.jsx)(n.code,{children:"entrypoint.sh"}),"): writes cron schedule and runs first cleanup at startup."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Container"})," (",(0,l.jsx)(n.code,{children:"Dockerfile"}),"): Python image running the script on schedule."]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"environment-variables",children:"Environment variables"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Name"}),(0,l.jsx)(n.th,{children:"Used by"}),(0,l.jsx)(n.th,{children:"Required"}),(0,l.jsx)(n.th,{children:"Default"}),(0,l.jsx)(n.th,{children:"Description"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"IMAP_SERVER"})}),(0,l.jsx)(n.td,{children:"script"}),(0,l.jsx)(n.td,{children:"Yes"}),(0,l.jsx)(n.td,{children:"none"}),(0,l.jsx)(n.td,{children:"IMAP server hostname or IP."})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"IMAP_PORT"})}),(0,l.jsx)(n.td,{children:"script"}),(0,l.jsx)(n.td,{children:"No"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"993"})}),(0,l.jsx)(n.td,{children:"IMAP SSL port."})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"EMAIL_USER"})}),(0,l.jsx)(n.td,{children:"script"}),(0,l.jsx)(n.td,{children:"Yes"}),(0,l.jsx)(n.td,{children:"none"}),(0,l.jsx)(n.td,{children:"Username for IMAP login."})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"EMAIL_PASS"})}),(0,l.jsx)(n.td,{children:"script"}),(0,l.jsx)(n.td,{children:"Yes"}),(0,l.jsx)(n.td,{children:"none"}),(0,l.jsx)(n.td,{children:"Password for IMAP login."})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"EMAIL_ADDRESS"})}),(0,l.jsx)(n.td,{children:"script"}),(0,l.jsx)(n.td,{children:"No"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"EMAIL_USER"})}),(0,l.jsx)(n.td,{children:"Mailbox label in logs/notifications."})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"CLEAN_DAYS"})}),(0,l.jsx)(n.td,{children:"script"}),(0,l.jsx)(n.td,{children:"No"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"10"})}),(0,l.jsxs)(n.td,{children:["Delete messages older than this many days. Ignored if ",(0,l.jsx)(n.code,{children:"--days"})," is passed."]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"SEND_TELEGRAM_NOTIFICATIONS"})}),(0,l.jsx)(n.td,{children:"script"}),(0,l.jsx)(n.td,{children:"No"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"false"})}),(0,l.jsxs)(n.td,{children:["Enable Telegram notifications (",(0,l.jsx)(n.code,{children:"1"}),", ",(0,l.jsx)(n.code,{children:"true"}),", ",(0,l.jsx)(n.code,{children:"yes"}),", ",(0,l.jsx)(n.code,{children:"on"}),")."]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"TELEGRAM_BOT_TOKEN"})}),(0,l.jsx)(n.td,{children:"script"}),(0,l.jsx)(n.td,{children:"Conditional"}),(0,l.jsx)(n.td,{children:"none"}),(0,l.jsx)(n.td,{children:"Required only if Telegram notifications are enabled."})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"CLEAN_EMAIL_TELEGRAM_CHAT_ID"})}),(0,l.jsx)(n.td,{children:"script"}),(0,l.jsx)(n.td,{children:"Conditional"}),(0,l.jsx)(n.td,{children:"none"}),(0,l.jsxs)(n.td,{children:["Preferred chat ID for this app. Has priority over ",(0,l.jsx)(n.code,{children:"TELEGRAM_CHAT_ID"}),"."]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"TELEGRAM_CHAT_ID"})}),(0,l.jsx)(n.td,{children:"script"}),(0,l.jsx)(n.td,{children:"Conditional"}),(0,l.jsx)(n.td,{children:"none"}),(0,l.jsxs)(n.td,{children:["Fallback chat ID if ",(0,l.jsx)(n.code,{children:"CLEAN_EMAIL_TELEGRAM_CHAT_ID"})," is not set."]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"TELEGRAM_TIMEOUT"})}),(0,l.jsx)(n.td,{children:"script"}),(0,l.jsx)(n.td,{children:"No"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"10"})}),(0,l.jsx)(n.td,{children:"Telegram API timeout in seconds."})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"SCHEDULE_MIN"})}),(0,l.jsx)(n.td,{children:"container entrypoint"}),(0,l.jsx)(n.td,{children:"No"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"0"})}),(0,l.jsxs)(n.td,{children:["Cron minute (",(0,l.jsx)(n.code,{children:"0-59"}),")."]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"SCHEDULE_HOUR"})}),(0,l.jsx)(n.td,{children:"container entrypoint"}),(0,l.jsx)(n.td,{children:"No"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"0"})}),(0,l.jsxs)(n.td,{children:["Cron hour (",(0,l.jsx)(n.code,{children:"0-23"}),")."]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"SCHEDULE_DAY"})}),(0,l.jsx)(n.td,{children:"container entrypoint"}),(0,l.jsx)(n.td,{children:"No"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"0"})}),(0,l.jsxs)(n.td,{children:["Cron weekday (",(0,l.jsx)(n.code,{children:"0-7"}),", where ",(0,l.jsx)(n.code,{children:"0"}),"/",(0,l.jsx)(n.code,{children:"7"})," is Sunday)."]})]})]})]}),"\n",(0,l.jsx)(n.h2,{id:"quick-start",children:"Quick start"}),"\n",(0,l.jsx)(n.h3,{id:"docker-ghcr-recommended",children:"Docker (GHCR, recommended)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'docker run -d \\\n  -e IMAP_SERVER="imap.server.com" \\\n  -e IMAP_PORT=993 \\\n  -e EMAIL_USER="your_username" \\\n  -e EMAIL_PASS="your_password" \\\n  -e EMAIL_ADDRESS="mailbox@example.com" \\\n  -e CLEAN_DAYS=10 \\\n  -e SEND_TELEGRAM_NOTIFICATIONS=true \\\n  -e TELEGRAM_BOT_TOKEN="123456:ABCDEF" \\\n  -e CLEAN_EMAIL_TELEGRAM_CHAT_ID="987654321" \\\n  -e TELEGRAM_CHAT_ID="123456789" \\\n  -e SCHEDULE_DAY=1 \\\n  -e SCHEDULE_HOUR=1 \\\n  -e SCHEDULE_MIN=30 \\\n  --name email_cleaner ghcr.io/gioxx/clean-mail-automation:latest\n'})}),"\n",(0,l.jsx)(n.h3,{id:"docker-docker-hub",children:"Docker (Docker Hub)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"docker run -d --name email_cleaner gfsolone/clean-mail-automation:latest\n"})}),"\n",(0,l.jsx)(n.h3,{id:"docker-build-locally-optional",children:"Docker build locally (optional)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"docker build -t email-cleaner .\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'docker run -d \\\n  -e IMAP_SERVER="imap.server.com" \\\n  -e IMAP_PORT=993 \\\n  -e EMAIL_USER="your_username" \\\n  -e EMAIL_PASS="your_password" \\\n  -e EMAIL_ADDRESS="mailbox@example.com" \\\n  -e CLEAN_DAYS=10 \\\n  -e SEND_TELEGRAM_NOTIFICATIONS=true \\\n  -e TELEGRAM_BOT_TOKEN="123456:ABCDEF" \\\n  -e CLEAN_EMAIL_TELEGRAM_CHAT_ID="987654321" \\\n  -e TELEGRAM_CHAT_ID="123456789" \\\n  -e SCHEDULE_DAY=1 \\\n  -e SCHEDULE_HOUR=1 \\\n  -e SCHEDULE_MIN=30 \\\n  --name email_cleaner email-cleaner\n'})}),"\n",(0,l.jsx)(n.h3,{id:"docker-compose",children:"Docker Compose"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.code,{children:"compose.yaml"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'services:\n  clean-mail-automation:\n    image: ghcr.io/gioxx/clean-mail-automation:latest\n    container_name: email_cleaner\n    restart: unless-stopped\n    environment:\n      IMAP_SERVER: "imap.server.com"\n      IMAP_PORT: "993"\n      EMAIL_USER: "your_username"\n      EMAIL_PASS: "your_password"\n      EMAIL_ADDRESS: "mailbox@example.com"\n      CLEAN_DAYS: "10"\n      SEND_TELEGRAM_NOTIFICATIONS: "true"\n      TELEGRAM_BOT_TOKEN: "123456:ABCDEF"\n      CLEAN_EMAIL_TELEGRAM_CHAT_ID: "987654321"\n      SCHEDULE_DAY: "1"\n      SCHEDULE_HOUR: "1"\n      SCHEDULE_MIN: "30"\n    # Alternative image:\n    # image: gfsolone/clean-mail-automation:latest\n'})}),"\n",(0,l.jsx)(n.h3,{id:"local-run-no-docker",children:"Local run (no Docker)"}),"\n",(0,l.jsx)(n.p,{children:"Prerequisites:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Python 3.x"}),"\n",(0,l.jsx)(n.li,{children:"Network access to your IMAP server"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Export variables and run:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'export IMAP_SERVER="imap.server.com"\nexport IMAP_PORT="993"\nexport EMAIL_USER="your_username"\nexport EMAIL_PASS="your_password"\nexport EMAIL_ADDRESS="mailbox@example.com"\nexport CLEAN_DAYS="10"\n\npython3 clean_email.py\n'})}),"\n",(0,l.jsx)(n.p,{children:"Optional retention override via CLI:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"python3 clean_email.py --days 30\n"})}),"\n",(0,l.jsxs)(n.p,{children:["For recurring runs without Docker, schedule ",(0,l.jsx)(n.code,{children:"python3 clean_email.py"})," using your platform scheduler (",(0,l.jsx)(n.code,{children:"cron"}),", ",(0,l.jsx)(n.code,{children:"systemd timer"}),", Windows Task Scheduler)."]}),"\n",(0,l.jsx)(n.h2,{id:"repository-structure",children:"Repository structure"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-text",children:"clean-mail-automation/\n|- clean_email.py\n|- entrypoint.sh\n|- Dockerfile\n|- README.md\n`- LICENSE\n"})}),"\n",(0,l.jsx)(n.h2,{id:"operational-notes",children:"Operational notes"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"entrypoint.sh"})," writes cron configuration and executes a first immediate cleanup."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"SCHEDULE_DAY=1"}),", ",(0,l.jsx)(n.code,{children:"SCHEDULE_HOUR=1"}),", ",(0,l.jsx)(n.code,{children:"SCHEDULE_MIN=30"})," means every Monday at 01:30."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"--days"})," (CLI) overrides ",(0,l.jsx)(n.code,{children:"CLEAN_DAYS"})," for that run."]}),"\n",(0,l.jsxs)(n.li,{children:["Disabled by default; enable with ",(0,l.jsx)(n.code,{children:"SEND_TELEGRAM_NOTIFICATIONS=true"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["Requires ",(0,l.jsx)(n.code,{children:"TELEGRAM_BOT_TOKEN"})," and a chat ID when enabled."]}),"\n",(0,l.jsxs)(n.li,{children:["Chat ID priority: ",(0,l.jsx)(n.code,{children:"CLEAN_EMAIL_TELEGRAM_CHAT_ID"})," first, then ",(0,l.jsx)(n.code,{children:"TELEGRAM_CHAT_ID"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["Container logs are available with ",(0,l.jsx)(n.code,{children:"docker logs email_cleaner"}),"."]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"license",children:"License"}),"\n",(0,l.jsxs)(n.p,{children:["MIT License. See ",(0,l.jsx)(n.code,{children:"LICENSE"})," in the repository."]})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(a,{...e})}):a(e)}},8453(e,n,i){i.d(n,{R:()=>d,x:()=>s});var r=i(6540);const l={},c=r.createContext(l);function d(e){const n=r.useContext(c);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:d(e.components),r.createElement(c.Provider,{value:n},e.children)}}}]);